!function(){"use strict";function e(e){e.when("/:roomId",{controller:"QueueController",templateUrl:"queue/queue.html"}).when("/",{controller:"HomeController",templateUrl:"home/home.html"}).otherwise({redirectTo:"/"})}angular.module("jukebox",["ngRoute","ngAnimate","ui.bootstrap","as.sortable","ngTouch","ngCookies"]).config(e),e.$inject=["$routeProvider"]}(),function(){"use strict";angular.module("jukebox").factory("sharedRoomData",function(){var e={roomId:"",roomName:"",passwordProtected:!1,roomPassword:"",userId:"",userName:"",queue:{}};return e})}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,templateUrl:"common/plusButton/plusButton.html",controller:["$scope","$uibModal",function(e,o){e.showSearch=function(){console.log("opening search modal");o.open({templateUrl:"search/search.html",controller:"SearchController",windowClass:"search-page",keyboard:!1})}}]}}angular.module("jukebox").directive("plusButton",e)}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,scope:{currentlyPlaying:"="},templateUrl:"common/header/header.html"}}angular.module("jukebox").directive("header",e)}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,scope:{},templateUrl:"common/footer/footer.html"}}angular.module("jukebox").directive("footer",e)}(),function(){"use strict";angular.module("jukebox").factory("backendAPI",["$http",function(e){var o="/api",t={};e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var n=function(e){var o,t,r,s,a,u,c,i="";for(o in e)if(t=e[o],t instanceof Array)for(c=0;c<t.length;++c)a=t[c],r=o+"["+c+"]",u={},u[r]=a,i+=n(u)+"&";else if(t instanceof Object)for(s in t)a=t[s],r=o+"["+s+"]",u={},u[r]=a,i+=n(u)+"&";else void 0!==t&&null!==t&&(i+=encodeURIComponent(o)+"="+encodeURIComponent(t)+"&");return i.length?i.substr(0,i.length-1):i};return e.defaults.transformRequest=[function(e){return angular.isObject(e)&&"[object File]"!==String(e)?n(e):e}],t.registerUser=function(t){return e.post(o+"/register_user",t)},t.changeUsername=function(t){return e.post(o+"/change_username",t)},t.joinRoom=function(t){return e.post(o+"/join_room",t)},t.getSongQueue=function(t){return e({method:"GET",url:o+"/get_song_queue",params:t})},t.addSong=function(t){return e.post(o+"/submit_song",t)},t.reorderSong=function(t){return e.post(o+"/reorder_song",t)},t.deleteSong=function(t){return e.post(o+"/delete_song",t)},t.searchRooms=function(t){return e.post(o+"/search_room",t)},t}])}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,scope:{},templateUrl:"search/search.html",controller:["$scope",function(){}]}}angular.module("jukebox").directive("search",e)}(),function(){"use strict";function e(e,o,t,n,r,s){function a(){n.getSongQueue({room_id:r.roomId,password:r.password}).success(function(e){"OK"===e.status?(r.roomName=e.room_name,r.queue=e.data,console.log("OK backendAPI.getSongQueue",e)):console.log("NOT OK backendAPI.getSongQueue",e)}).error(function(e){console.log("ERROR backendAPI.getSongQueue",e)})}e.roomId=o.roomId,e.myData={},e.myData.spotify={},e.myData.sendQuery=function(){var o=t.get("https://api.spotify.com/v1/search",{params:{q:e.searchText,type:"track"}});o.success(function(o){e.myData.spotify.results=o.tracks.items}),o.error(function(){e.myData.spotify={},console.log("ERROR returning results from spotify")})},e.closeSearch=function(){s.close()},e.addSong=function(o,t,s,u,c){n.addSong({room_id:r.roomId,user_id:r.userId,password:r.password,url:o,track:t,artist:s,album:u,album_art_url:c}).success(function(o){"OK"===o.status?(a(),console.log("OK backendAPI.addSong",o)):console.log("NOT OK backendAPI.addSong",o),e.closeSearch()}).error(function(e){console.log("ERROR backendAPI.addSong",e)})}}angular.module("jukebox").controller("SearchController",e),e.$inject=["$scope","$routeParams","$http","backendAPI","sharedRoomData","$uibModalInstance"]}(),function(){"use strict";angular.module("jukebox").controller("QueueController",["$scope","$routeParams","$cookies","backendAPI","sharedRoomData",function(e,o,t,n,r){function s(e){n.registerUser({username:e}).success(function(e){"OK"===e.status?(r.userId=e.data,t.put("jb_user_name",r.userName),t.put("jb_user_id",r.userId),a(),console.log("OK backendAPI.registerUser",e)):console.log("NOT OK backendAPI.registerUser",e)}).error(function(e){console.log("ERROR backendAPI.registerUser",e)})}function a(){n.joinRoom({room_id:r.roomId,user_id:r.userId,password:r.password}).success(function(e){"OK"===e.status?(console.log("OK backendAPI.joinRoom",e),u()):("The correct password was not provided."==e.message&&(r.passwordProtected=!0,r.password=window.prompt("Enter the password:"),t.put(r.roomId,r.password),a()),console.log("NOT OK backendAPI.joinRoom",e))}).error(function(e){console.log("ERROR backendAPI.joinRoom",e)})}function u(){n.getSongQueue({room_id:r.roomId,password:r.password}).success(function(e){"OK"===e.status?(r.roomName=e.room_name,r.queue=e.data,console.log("OK backendAPI.getSongQueue",e)):("The correct password was not provided."==e.message&&(r.passwordProtected=!0,r.password=window.prompt("Enter the password:"),t.put(r.roomId,r.password),u()),console.log("NOT OK backendAPI.getSongQueue",e))}).error(function(e){console.log("ERROR backendAPI.getSongQueue",e)})}function c(e,o){n.reorderSong({room_id:r.roomId,user_id:r.userId,password:r.password,song_id:e,new_pos:o}).success(function(e){"OK"===e.status?(console.log("OK backendAPI.reorderSong",e),u()):console.log("NOT OK backendAPI.reorderSong",e)}).error(function(){console.log("ERROR backendAPI.reorderSong",error)})}function i(e){n.deleteSong({room_id:r.roomId,user_id:r.userId,password:r.password,song_id:e}).success(function(e){"OK"===e.status?(console.log("OK backendAPI.deleteSong",e),u()):console.log("NOT OK backendAPI.deleteSong",e)}).error(function(){console.log("ERROR backendAPI.deleteSong",error)})}e.pageClass="queue-page",e.room=r,r.roomId=o.roomId,e.roomId=r.roomId;var l=["banana","apple","peach","mango","cherry","grape","pear","plum","pineapple","kiwi"];r.userId=t.get("jb_user_id"),r.userName=t.get("jb_user_name"),r.password=t.get(r.roomId)?t.get(r.roomId):"",r.userId&&r.userName?(console.log("You already have a username! It is",r.userName),a()):(r.userName=l[Math.floor(Math.random()*l.length)],console.log("Your username will be",r.userName),s(r.userName)),e.dragControlListeners={accept:function(){return!0},itemMoved:function(){},orderChanged:function(e){var o=e.source.itemScope.element[0].dataset.uuid,t=e.dest.index;c(o,t)}},e.deleteSong=function(e){var o=e.target.parentElement.dataset.uuid;i(o)}}])}(),function(){"use strict";function e(e,o,t){function n(o,t){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){e.logoFill="url(#lg)",console.log("Location acquired.");var n=t.coords.latitude,r=t.coords.longitude;e.coordinates=[n,r],console.log(e.coordinates),o&&o()},function(){t&&t()},{timeout:1e3*r},{maximumAge:1e3*s}):t&&t()}var r=30,s=60;e.pageClass="home-page",e.coordinates=[],n(function(){t.searchRooms({coordinates:e.coordinates[0]+","+e.coordinates[1],distance:"10000"}).success(function(e){"OK"===e.status?(console.log("OK backendAPI.searchRooms",e),o.path(e.data[0].id)):console.log("NOT OK backendAPI.searchRooms",e)}).error(function(e){console.log("NOT OK backendAPI.searchRooms",e)})},function(){console.log("Could not get location.")})}angular.module("jukebox").controller("HomeController",e),e.$inject=["$scope","$location","backendAPI"]}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/home/home.html",'<div class="home-page"><div class="jb-icon"><svg><lineargradient id="lg" x1="1" y1="1" x2="0" y2="0"><stop offset="0%" stop-opacity="1" stop-color="white"><stop offset="0%" stop-opacity="1" stop-color="white"><animate attributename="offset" values="0;1" fill="freeze" repeatcount="0" dur="5s" begin="0s"></stop><stop offset="0%" stop-opacity="1" stop-color="black"><animate attributename="offset" values="0;1" fill="freeze" repeatcount="0" dur="5s" begin="0s"></stop><stop offset="100%" stop-opacity="1" stop-color="black"></lineargradient><use xlink:href="#plus-icon"></use></svg></div></div>')}])}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/queue/queue.html",'<div class="queue-wrapper"><div header currently-playing="room.queue[0]"></div><div ng-if="queueData.length > 0"><span>Your Song Queue</span></div><div class="song-queue" data-as-sortable="dragControlListeners" data-ng-model="room.queue"><div ng-repeat="song in room.queue" ng-if="!$first"><div class="song-queue-item noselect" data-uuid="{{ song.unique_id }}" data-as-sortable-item ng-swipe-left="showDeleteButton = true" ng-swipe-right="showDeleteButton = false"><img src="{{ song.image_url }}" class="song-image"><div class="song-info"><div class="song-title">{{ song.track }}</div><div class="song-artist">{{ song.artist }}</div><div class="song-user">@{{ song.submitter }}</div></div><i class="fa fa-th-list drag-button" ng-if="!showDeleteButton" data-as-sortable-item-handle></i> <i class="fa fa-trash fa-lg delete-button" ng-if="showDeleteButton" ng-click="deleteSong($event)"></i></div></div></div></div><div plus-button></div>')}])}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/search/search.html",'<div class="search-wrapper"><div class="search-header-items"><div class="search-header-item close-search"><button ng-click="closeSearch()"><span>Cancel</span></button></div><div class="search-header-item search"><input id="song-search-box" type="search" ng-model="searchText" ng-model-options="{ debounce: 500 }" ng-change="myData.sendQuery()" autofocus></div></div><div class="song-search-results"><div ng-if="myData.spotify.results.length > 0"><span>Spotify Results</span></div><div ng-repeat="result in myData.spotify.results"><div ng-click="addSong(result.uri, result.name, result.artists[0].name, result.album.name, result.album.images[0].url)" class="song-search-result"><img src="{{ result.album.images[0].url }}" class="song-image"><div class="song-info"><div class="song-title">{{ result.name }}</div><div class="song-artist">{{ result.artists[0].name }}</div></div></div></div></div></div>')}])}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/common/footer/footer.html",'<div class="footer"><div class="footer-label"><span>Jukebox App</span></div><div class="footer-copyright"><span>&copy; 2016, All rights reserved.</span></div></div>')}])}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/common/plusButton/plusButton.html",'<button ng-click="showSearch()" class="plus-button"><div class="plus-icon"><svg><use xlink:href="#plus-icon"></use></svg></div></button>')}])}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/common/header/header.html",'<div class="header"><div class="header-info" ng-if="currentlyPlaying"><div class="header-label song"><span>{{ currentlyPlaying.track }}</span></div><div class="header-label artist"><span>{{ currentlyPlaying.artist }}</span></div><div class="header-label user"><span>@{{ currentlyPlaying.submitter }}</span></div></div><div class="record-player"><div class="record" ng-if="currentlyPlaying"><img src="{{ currentlyPlaying.image_url }}"></div></div></div>')}])}();