!function(){"use strict";function e(e){e.when("/:roomId",{controller:"QueueController",templateUrl:"queue/queue.html"}).when("/",{controller:"HomeController",templateUrl:"home/home.html"}).otherwise({redirectTo:"/"})}angular.module("jukebox",["ngRoute","ngAnimate","ui.bootstrap","as.sortable","ngTouch","ngCookies","matchMedia"]).config(e),e.$inject=["$routeProvider"]}(),function(){"use strict";function e(e,o,t,r,n){function s(){("mobile"!=o.responsiveVersion||""!==e.yt_video_id)&&e.room.queue[0].unique_id!=i&&(i=n.queue[0].unique_id,a().success(function(o){console.log("OK YoutubeController.updateCurrentVideo",o),o.items.length>=1&&(e.yt_video_id=o.items[0].id.videoId)}).error(function(e){console.log("ERROR YoutubeController.updateCurrentVideo",e)}))}function a(){return t({url:"https://www.googleapis.com/youtube/v3/search",method:"GET",params:{part:"snippet",key:u,q:e.room.queue[0].track+" "+e.room.queue[0].artist,type:"video",videoEmbeddable:"true"}})}var u="AIzaSyALGbklexv5u7P3zjV4xJCYfEYLwwukfkE";e.room=n,e.yt_video_id="";var i="";o.$watch("responsiveVersion",function(){s()}),e.$watch("room.queue",function(){s()})}angular.module("jukebox").controller("YoutubeController",e).filter("youtubeEmbedUrl",["$sce",function(e){return function(o){return e.trustAsResourceUrl("http://www.youtube.com/embed/"+o+"?autoplay=1&iv_load_policy=3&origin=http://letsjukebox.com/")}}]),e.$inject=["$scope","$rootScope","$http","$sce","sharedRoomData"]}(),function(){"use strict";angular.module("jukebox").factory("sharedRoomData",function(){var e={roomId:"",roomName:"",passwordProtected:!1,roomPassword:"",userId:"",userName:"",queue:{}};return e})}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,templateUrl:"common/plusButton/plusButton.html",controller:["$scope","$uibModal",function(e,o){e.showSearch=function(){console.log("opening search modal");o.open({templateUrl:"search/search.html",controller:"SearchController",windowClass:"search-page",keyboard:!1})}}]}}angular.module("jukebox").directive("plusButton",e)}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,scope:{currentlyPlaying:"="},templateUrl:"common/header/header.html"}}angular.module("jukebox").directive("header",e).filter("spotifyEmbedUrl",["$sce",function(e){return function(o){return e.trustAsResourceUrl("https://embed.spotify.com/?uri="+o)}}])}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,scope:{},templateUrl:"common/footer/footer.html"}}angular.module("jukebox").directive("footer",e)}(),function(){"use strict";angular.module("jukebox").factory("backendAPI",["$http",function(e){var o="/api",t={};e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var r=function(e){var o,t,n,s,a,u,i,c="";for(o in e)if(t=e[o],t instanceof Array)for(i=0;i<t.length;++i)a=t[i],n=o+"["+i+"]",u={},u[n]=a,c+=r(u)+"&";else if(t instanceof Object)for(s in t)a=t[s],n=o+"["+s+"]",u={},u[n]=a,c+=r(u)+"&";else void 0!==t&&null!==t&&(c+=encodeURIComponent(o)+"="+encodeURIComponent(t)+"&");return c.length?c.substr(0,c.length-1):c};return e.defaults.transformRequest=[function(e){return angular.isObject(e)&&"[object File]"!==String(e)?r(e):e}],t.registerUser=function(t){return e.post(o+"/register_user",t)},t.changeUsername=function(t){return e.post(o+"/change_username",t)},t.joinRoom=function(t){return e.post(o+"/join_room",t)},t.getSongQueue=function(t){return e({method:"GET",url:o+"/get_song_queue",params:t})},t.addSong=function(t){return e.post(o+"/submit_song",t)},t.reorderSong=function(t){return e.post(o+"/reorder_song",t)},t.deleteSong=function(t){return e.post(o+"/delete_song",t)},t.searchRooms=function(t){return e.post(o+"/search_room",t)},t}])}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,scope:{},templateUrl:"search/search.html",controller:["$scope",function(){}]}}angular.module("jukebox").directive("search",e)}(),function(){"use strict";function e(e,o,t,r,n,s){function a(){r.getSongQueue({room_id:n.roomId,password:n.password}).success(function(e){"OK"===e.status?(n.roomName=e.room_name,n.queue=e.data,console.log("OK backendAPI.getSongQueue",e)):console.log("NOT OK backendAPI.getSongQueue",e)}).error(function(e){console.log("ERROR backendAPI.getSongQueue",e)})}e.roomId=o.roomId,e.myData={},e.myData.spotify={},e.myData.sendQuery=function(){var o=t.get("https://api.spotify.com/v1/search",{params:{q:e.searchText,type:"track"}});o.success(function(o){e.myData.spotify.results=o.tracks.items}),o.error(function(){e.myData.spotify={},console.log("ERROR returning results from spotify")})},e.closeSearch=function(){s.close()},e.addSong=function(o,t,s,u,i){r.addSong({room_id:n.roomId,user_id:n.userId,password:n.password,url:o,track:t,artist:s,album:u,album_art_url:i}).success(function(o){"OK"===o.status?(a(),console.log("OK backendAPI.addSong",o)):console.log("NOT OK backendAPI.addSong",o),e.closeSearch()}).error(function(e){console.log("ERROR backendAPI.addSong",e)})}}angular.module("jukebox").controller("SearchController",e),e.$inject=["$scope","$routeParams","$http","backendAPI","sharedRoomData","$uibModalInstance"]}(),function(){"use strict";angular.module("jukebox").controller("QueueController",["$scope","$rootScope","$interval","$routeParams","$cookies","backendAPI","sharedRoomData","screenSize",function(e,o,t,r,n,s,a,u){function i(e){s.registerUser({username:e}).success(function(e){"OK"===e.status?(a.userId=e.data,n.put("jb_user_name",a.userName),n.put("jb_user_id",a.userId),c(),console.log("OK backendAPI.registerUser",e)):console.log("NOT OK backendAPI.registerUser",e)}).error(function(e){console.log("ERROR backendAPI.registerUser",e)})}function c(){s.joinRoom({room_id:a.roomId,user_id:a.userId,password:a.password}).success(function(e){"OK"===e.status?(console.log("OK backendAPI.joinRoom",e),l()):("The correct password was not provided."==e.message&&(a.passwordProtected=!0,a.password=window.prompt("Enter the password:"),n.put(a.roomId,a.password),c()),console.log("NOT OK backendAPI.joinRoom",e))}).error(function(e){console.log("ERROR backendAPI.joinRoom",e)})}function l(){s.getSongQueue({room_id:a.roomId,password:a.password}).success(function(e){"OK"===e.status?(a.roomName=e.room_name,a.queue=e.data,g||(g=t(function(){l()},p)),console.log("OK backendAPI.getSongQueue",e)):("The correct password was not provided."==e.message&&(a.passwordProtected=!0,a.password=window.prompt("Enter the password:"),n.put(a.roomId,a.password),l()),console.log("NOT OK backendAPI.getSongQueue",e))}).error(function(e){console.log("ERROR backendAPI.getSongQueue",e)})}function d(e,o){s.reorderSong({room_id:a.roomId,user_id:a.userId,password:a.password,song_id:e,new_pos:o}).success(function(e){"OK"===e.status?(console.log("OK backendAPI.reorderSong",e),l()):console.log("NOT OK backendAPI.reorderSong",e)}).error(function(){console.log("ERROR backendAPI.reorderSong",error)})}function m(e){s.deleteSong({room_id:a.roomId,user_id:a.userId,password:a.password,song_id:e}).success(function(e){"OK"===e.status?(console.log("OK backendAPI.deleteSong",e),l()):console.log("NOT OK backendAPI.deleteSong",e)}).error(function(){console.log("ERROR backendAPI.deleteSong",error)})}e.pageClass="queue-page";var g=void 0,p=3e3;o.responsiveVersion=u.is("xs, sm")?"mobile":"desktop",e.mobile=u.on("xs, sm",function(t){e.mobile=t,o.responsiveVersion=t?"mobile":"desktop"}),e.room=a,a.roomId=r.roomId,e.roomId=a.roomId;var f=["banana","apple","peach","mango","cherry","grape","pear","plum","pineapple","kiwi"];a.userId=n.get("jb_user_id"),a.userName=n.get("jb_user_name"),a.password=n.get(a.roomId)?n.get(a.roomId):"",a.userId&&a.userName?(console.log("You already have a username! It is",a.userName),c()):(a.userName=f[Math.floor(Math.random()*f.length)],console.log("Your username will be",a.userName),i(a.userName)),e.dragControlListeners={accept:function(){return!0},itemMoved:function(){},orderChanged:function(e){var o=e.source.itemScope.element[0].dataset.uuid,t=e.dest.index;d(o,t)}},e.deleteSong=function(e){var o=e.target.parentElement.dataset.uuid;m(o)}}])}(),function(){"use strict";function e(e,o,t){function r(o,t){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){e.logoFill="url(#lg)",console.log("Location acquired.");var r=t.coords.latitude,n=t.coords.longitude;e.coordinates=[r,n],console.log(e.coordinates),o&&o()},function(){t&&t()},{timeout:1e3*n},{maximumAge:1e3*s}):t&&t()}var n=30,s=60;e.pageClass="home-page",e.coordinates=[],r(function(){t.searchRooms({coordinates:e.coordinates[0]+","+e.coordinates[1],distance:"10000"}).success(function(e){"OK"===e.status?(console.log("OK backendAPI.searchRooms",e),e.data.length>=1?o.path(e.data[0].id):console.log("No nearby rooms available.")):console.log("NOT OK backendAPI.searchRooms",e)}).error(function(e){console.log("NOT OK backendAPI.searchRooms",e)})},function(){console.log("Could not get location.")})}angular.module("jukebox").controller("HomeController",e),e.$inject=["$scope","$location","backendAPI"]}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/home/home.html",'<div class="home-page"><div class="jb-icon"><svg><lineargradient id="lg" x1="1" y1="1" x2="0" y2="0"><stop offset="0%" stop-opacity="1" stop-color="white"><stop offset="0%" stop-opacity="1" stop-color="white"><animate attributename="offset" values="0;1" fill="freeze" repeatcount="0" dur="5s" begin="0s"></stop><stop offset="0%" stop-opacity="1" stop-color="black"><animate attributename="offset" values="0;1" fill="freeze" repeatcount="0" dur="5s" begin="0s"></stop><stop offset="100%" stop-opacity="1" stop-color="black"></lineargradient><use xlink:href="#plus-icon"></use></svg></div></div>')}])}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/queue/queue.html",'<div class="desktop-content"><div ng-controller="YoutubeController" ng-if="room.queue[0]"><div class="iframe-container"><iframe id="ytplayer" type="text/html" ng-src="{{ yt_video_id | youtubeEmbedUrl }}" frameborder="0" allowfullscreen></div></div></div><div class="queue-wrapper"><div header currently-playing="room.queue[0]"></div><div ng-if="queueData.length > 0"><span>Your Song Queue</span></div><div class="song-queue" data-as-sortable="dragControlListeners" data-ng-model="room.queue"><div ng-repeat="song in room.queue"><div class="song-queue-item noselect" data-uuid="{{ song.unique_id }}" data-as-sortable-item ng-swipe-left="showDeleteButton = true" ng-swipe-right="showDeleteButton = false"><img src="{{ song.image_url }}" class="song-image"><div class="song-info"><div class="song-title">{{ song.track }}</div><div class="song-artist">{{ song.artist }}</div><div class="song-user">@{{ song.submitter }}</div></div><i class="fa fa-th-list drag-button" ng-if="!showDeleteButton" data-as-sortable-item-handle></i> <i class="fa fa-trash fa-lg delete-button" ng-if="showDeleteButton" ng-click="deleteSong($event)"></i></div></div></div></div><div plus-button></div>')}])}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/search/search.html",'<div class="search-wrapper"><div class="search-header-items"><div class="search-header-item close-search"><button ng-click="closeSearch()"><span>Cancel</span></button></div><div class="search-header-item search"><input id="song-search-box" type="search" ng-model="searchText" ng-model-options="{ debounce: 500 }" ng-change="myData.sendQuery()" autofocus></div></div><div class="song-search-results"><div ng-if="myData.spotify.results.length > 0"><span>Spotify Results</span></div><div ng-repeat="result in myData.spotify.results"><div ng-click="addSong(result.uri, result.name, result.artists[0].name, result.album.name, result.album.images[0].url)" class="song-search-result"><img src="{{ result.album.images[0].url }}" class="song-image"><div class="song-info"><div class="song-title">{{ result.name }}</div><div class="song-artist">{{ result.artists[0].name }}</div></div></div></div></div></div>')}])}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/common/footer/footer.html",'<div class="footer"><div class="footer-label"><span>Jukebox App</span></div><div class="footer-copyright"><span>&copy; 2016, All rights reserved.</span></div></div>')}])}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/common/header/header.html",'<div class="header"><div class="header-info" ng-if="currentlyPlaying"><div class="header-label song"><span>{{ currentlyPlaying.track }}</span></div><div class="header-label artist"><span>{{ currentlyPlaying.artist }}</span></div><div class="header-label user"><span>@{{ currentlyPlaying.submitter }}</span></div></div><div class="record-player"><div class="record" ng-if="currentlyPlaying"><img src="{{ currentlyPlaying.image_url }}"></div></div></div>')}])}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/common/plusButton/plusButton.html",'<button ng-click="showSearch()" class="plus-button"><div class="plus-icon"><svg><use xlink:href="#plus-icon"></use></svg></div></button>')}])}();