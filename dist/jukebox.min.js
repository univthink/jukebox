"use strict";!function(){angular.module("jukebox",["ngRoute","ngAnimate","ui.bootstrap","as.sortable","ngTouch","ngCookies","matchMedia","spotify"]).directive("compile",["$compile","$timeout",function(t,e){return{restrict:"A",link:function(o,n){e(function(){t(n.contents())(o)})}}}]).config(["$compileProvider","$routeProvider","$locationProvider","SpotifyProvider",function(t,e,o,n){t.debugInfoEnabled(!1),e.when("/dataviz",{controller:"DatavizController",templateUrl:"dataviz/dataviz.html"}).when("/spotify_login",{templateUrl:"dataviz/spotify_login.html"}).when("/:roomId",{controller:"QueueController",templateUrl:"queue/queue.html"}).when("/",{controller:"HomeController",templateUrl:"home/home.html"}).otherwise({redirectTo:"/"}),o.html5Mode(!0),n.setClientId("39903cb10e0a4f6da882d6c53db62776"),n.setRedirectUri("http://localhost:8080/spotify_login/"),n.setScope("user-library-read user-top-read")}])}(),function(){function t(t){t.changeXAxisCategory=function(){console.log(t.xAxisCategory)},t.changeYAxisCategory=function(){for(var e=0;e<t.musicTracks.length;e++)t.musicTracks[e].y_category=t.musicTracks[e].audio_features[t.yAxisCategory];t.updateGraph()},t.changeTopTimePeriod=function(){document.getElementById("mygraph").classList=[],document.getElementById("mygraph").classList.add(t.selectedTimePeriod),t.toggleHiddenNonTopTracks()},t.toggleHiddenNonTopTracks=function(){t.nonTopTracksHidden?document.getElementById("mygraph").classList.add("hide-non-top"):document.getElementById("mygraph").classList.remove("hide-non-top")}}angular.module("jukebox").controller("GraphControlsController",t),t.$inject=["$scope"]}(),function(){function t(t){function e(){d.selectAll("circle").classed("animate",!1).attr("cx",function(t){return a(t.date)}).attr("cy",function(t){return l(t.y_category)}),d3.select(".x.axis").call(u),d3.select(".y.axis").call(c)}t.selectedTimePeriod="long_term",t.xAxisCategory="time",t.yAxisCategory="energy";var o={top:50,right:20,bottom:30,left:60},n=50,i=1e3-o.left-o.right,s=450-o.top-o.bottom,r=d3.time.format.iso.parse,a=d3.time.scale().range([n,i]),l=d3.scale.linear().range([n/2,s]),u=d3.svg.axis().scale(a).orient("top").ticks(5).tickSize(8),c=d3.svg.axis().scale(l).orient("left").ticks(5).tickSize(8),d=d3.select(".mydiv").append("svg").attr("width",i+o.left+o.right).attr("height",s+o.top+o.bottom).append("g").attr("transform","translate("+o.left+","+o.top+")"),p=d3.select(".mydiv").append("div").attr("class","tooltip").style("opacity",0),g=t.musicTracks,m=!0,f=!1,h=void 0;try{for(var v,y=g[Symbol.iterator]();!(m=(v=y.next()).done);m=!0){var b=v.value;b.date=r(b.added_at),b.y_category=b.audio_features[t.yAxisCategory]}}catch(k){f=!0,h=k}finally{try{!m&&y.return&&y.return()}finally{if(f)throw h}}a.domain(d3.extent(g,function(t){return t.date})),l.domain([0,d3.max(g,function(t){return t.y_category})+.1]),d.append("rect").attr("width",i+o.left+o.right+n).attr("height",s+o.top+o.bottom+n),d.selectAll("dot").data(g).enter().append("circle").attr("class","dot").attr("class",function(t){return t.is_top.length>0?"top "+t.is_top.join(" "):void 0}).attr("r",8).style("opacity",.6).attr("cx",function(t){return a(t.date)}).attr("cy",function(t){return l(t.y_category)}).on("mouseover",function(t){d3.select(this).attr("r",16).classed("selected",!0),p.transition().duration(200).style("opacity",.7).attr("r",30),p.html(t.name+"<br>"+t.artists[0].name).style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-parseInt(p.node().getBoundingClientRect().height+10)+"px")}).on("mouseout",function(){d3.select(this).attr("r",8).classed("selected",!1),p.transition().duration(500).style("opacity",0)}).on("click",function(e){t.playSelectedSong(e.name,e.artists[0].name)}),d.append("g").attr("class","x axis").call(u),d.append("g").attr("class","y axis").call(c),d.call(d3.behavior.zoom().x(a).y(l).on("zoom",e)),t.updateGraph=function(){d.selectAll("circle").classed("animate",!0).attr("cx",function(t){return a(t.date)}).attr("cy",function(t){return l(t.y_category)}),d3.select(".x.axis").call(u),d3.select(".y.axis").call(c)}}angular.module("jukebox").controller("GraphController",t),t.$inject=["$scope"]}(),function(){function t(t,e,o,n,i){function s(e,o){r(e,o).success(function(e){e.items.length>=1&&(t.yt_video_id=e.items[0].id.videoId)}).error(function(t){console.log("ERROR YoutubeController.updateCurrentVideo",t)})}function r(t,e){return o({url:"https://www.googleapis.com/youtube/v3/search",method:"GET",params:{part:"snippet",key:a,q:t+" "+e,type:"video",videoEmbeddable:"true"}})}var a="AIzaSyALGbklexv5u7P3zjV4xJCYfEYLwwukfkE";t.room=i,t.yt_video_id="";t.$on("updateVideoEvent",function(t,e,o){s(e,o)})}angular.module("jukebox").controller("YoutubeController",t).filter("youtubeEmbedUrl",["$sce",function(t){return function(e){return t.trustAsResourceUrl("http://www.youtube.com/embed/"+e+"?autoplay=1&iv_load_policy=3&origin=http://letsjukebox.com/")}}]),t.$inject=["$scope","$rootScope","$http","$sce","sharedRoomData"]}(),function(){function t(){return{restrict:"A",replace:!0,template:'<div class="spinner"> <!-- kudos to Tobias Ahlin! [http://tobiasahlin.com/spinkit/] --> <div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>'}}angular.module("jukebox").directive("spinner",t)}(),function(){angular.module("jukebox").factory("sharedRoomData",function(){var t={roomId:"",roomName:"",allAdmin:!1,passwordProtected:!1,roomPassword:"",userId:"",userName:"",loaded:!1,queue:{},trending:[]};return t})}(),function(){function t(){return{restrict:"A",replace:!0,templateUrl:"common/plusButton/plusButton.html",controller:["$scope","$uibModal",function(t,e){t.showSearch=function(){e.open({templateUrl:"search/search.html",controller:"SearchController",windowClass:"search-page",keyboard:!1})}}]}}angular.module("jukebox").directive("plusButton",t)}(),function(){function t(){return{restrict:"A",replace:!0,scope:{currentlyPlaying:"="},templateUrl:"common/header/header.html"}}angular.module("jukebox").directive("header",t).filter("spotifyEmbedUrl",["$sce",function(t){return function(e){return t.trustAsResourceUrl("https://embed.spotify.com/?uri="+e)}}])}(),function(){function t(){return{restrict:"A",replace:!0,scope:{},templateUrl:"common/footer/footer.html"}}angular.module("jukebox").directive("footer",t)}(),function(){angular.module("jukebox").factory("backendAPI",["$http",function(t){var e="/api",o={};t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var n=function i(t){var e,o,n,s,r,a,l,u="";for(e in t)if(o=t[e],o instanceof Array)for(l=0;l<o.length;++l)r=o[l],n=e+"["+l+"]",a={},a[n]=r,u+=i(a)+"&";else if(o instanceof Object)for(s in o)r=o[s],n=e+"["+s+"]",a={},a[n]=r,u+=i(a)+"&";else void 0!==o&&null!==o&&(u+=encodeURIComponent(e)+"="+encodeURIComponent(o)+"&");return u.length?u.substr(0,u.length-1):u};return t.defaults.transformRequest=[function(t){return angular.isObject(t)&&"[object File]"!==String(t)?n(t):t}],o.registerUser=function(o){return t.post(e+"/register_user",o)},o.changeUsername=function(o){return t.post(e+"/change_username",o)},o.joinRoom=function(o){return t.post(e+"/join_room",o)},o.getSongQueue=function(o){return t({method:"GET",url:e+"/get_song_queue",params:o})},o.addSong=function(o){return t.post(e+"/submit_song",o)},o.reorderSong=function(o){return t.post(e+"/reorder_song",o)},o.deleteSong=function(o){return t.post(e+"/delete_song",o)},o.searchRooms=function(o){return t.post(e+"/search_room",o)},o.getTrendingSongs=function(){return t.get(e+"/get_trending_songs")},o}])}(),function(){function t(){return{restrict:"A",replace:!0,scope:{},templateUrl:"search/search.html",controller:["$scope",function(){}]}}angular.module("jukebox").directive("search",t)}(),function(){function t(t,e,o,n,i,s){function r(){n.getSongQueue({room_id:i.roomId,password:i.password}).success(function(t){"OK"===t.status?(i.roomName=t.room_name,i.queue=t.data,console.log("OK backendAPI.getSongQueue",t)):console.log("NOT OK backendAPI.getSongQueue",t)}).error(function(t){console.log("ERROR backendAPI.getSongQueue",t)})}t.roomId=e.roomId,t.querying=!0,t.myData={},t.myData.spotify={},t.myData.spotify.suggestions=i.trending,t.myData.sendQuery=function(){t.querying=!0;var e=o.get("https://api.spotify.com/v1/search",{params:{q:t.searchText,type:"track"}});e.success(function(e){t.querying=!1,console.log("OK SearchController.sendQuery",e),t.myData.spotify.results=e.tracks.items}),e.error(function(){t.querying=!1,t.myData.spotify.results=null,console.log("ERROR returning results from spotify")})},t.closeSearch=function(){s.close()},t.addSong=function(e,o,s,a,l){n.addSong({room_id:i.roomId,user_id:i.userId,password:i.password,url:e,track:o,artist:s,album:a,album_art_url:l}).success(function(e){"OK"===e.status?(r(),console.log("OK backendAPI.addSong",e)):console.log("NOT OK backendAPI.addSong",e),t.closeSearch()}).error(function(t){console.log("ERROR backendAPI.addSong",t)})}}angular.module("jukebox").controller("SearchController",t),t.$inject=["$scope","$routeParams","$http","backendAPI","sharedRoomData","$uibModalInstance"]}(),function(){angular.module("jukebox").controller("QueueController",["$scope","$rootScope","$interval","$routeParams","$cookies","$uibModal","backendAPI","sharedRoomData","screenSize",function(t,e,o,n,i,s,r,a,l){function u(){s.open({templateUrl:"common/ui-elements/defaultModal.html",controller:["$scope","$sce","$uibModalInstance","sharedRoomData",function(t,e,o,n){t.modal_title="Enter Your Alias",t.modal_body_html=e.trustAsHtml('<span>@</span><input type="text" ng-model="aliasInput" class="form-control" autofocus required />'),t.primary_btn_text="CONTINUE",t.ok=function(){t.aliasInput&&!/[^a-zA-Z0-9]/.test(t.aliasInput)&&(o.close(),n.userName=t.aliasInput,c(n.userName))}}],backdrop:"static",windowClass:"default",keyboard:!1})}function c(t){r.registerUser({username:t}).success(function(t){"OK"===t.status?(a.userId=t.data,i.put("jb_user_name",a.userName),i.put("jb_user_id",a.userId),d(),console.log("OK backendAPI.registerUser",t)):console.log("NOT OK backendAPI.registerUser",t)}).error(function(t){console.log("ERROR backendAPI.registerUser",t)})}function d(){r.joinRoom({room_id:a.roomId,user_id:a.userId,password:a.password}).success(function(t){"OK"===t.status?(console.log("OK backendAPI.joinRoom",t),p()):("The correct password was not provided."===t.message&&(a.passwordProtected=!0,a.password=window.prompt("Enter the password:"),i.put(a.roomId,a.password),d()),console.log("NOT OK backendAPI.joinRoom",t))}).error(function(t){console.log("ERROR backendAPI.joinRoom",t)})}function p(){r.getSongQueue({room_id:a.roomId,password:a.password}).success(function(t){"OK"===t.status?(console.log("OK backendAPI.getSongQueue",t),a.roomName=t.room_name,a.queue=t.data,a.allAdmin="1"==t.all_admin?!0:!1,a.loaded=!0,h||(h=o(function(){f||p()},v))):("The correct password was not provided."===t.message&&(a.passwordProtected=!0,a.password=window.prompt("Enter the password:"),i.put(a.roomId,a.password),p()),console.log("NOT OK backendAPI.getSongQueue",t))}).error(function(t){console.log("ERROR backendAPI.getSongQueue",t)})}function g(t,e){r.reorderSong({room_id:a.roomId,user_id:a.userId,password:a.password,song_id:t,new_pos:e}).success(function(t){"OK"===t.status?(console.log("OK backendAPI.reorderSong",t),p()):console.log("NOT OK backendAPI.reorderSong",t)}).error(function(){console.log("ERROR backendAPI.reorderSong",error)})}function m(t){r.deleteSong({room_id:a.roomId,user_id:a.userId,password:a.password,song_id:t}).success(function(t){"OK"===t.status?(console.log("OK backendAPI.deleteSong",t),p()):console.log("NOT OK backendAPI.deleteSong",t)}).error(function(){console.log("ERROR backendAPI.deleteSong",error)})}t.pageClass="queue-page";var f=!1,h=void 0,v=3e3;e.responsiveVersion=l.is("xs, sm")?"mobile":"desktop",t.mobile=l.on("xs, sm",function(o){t.mobile=o,e.responsiveVersion=o?"mobile":"desktop"}),t.room=a,a.roomId=n.roomId,t.roomId=a.roomId;var y=["BlueTrout","YellowDuck","RedHerring","BoredMoose","SillyWhale","OrangeEagle","VelvetMouse","GreenMonkey","VioletLobster","ConfusedTucan","WileySloth"];if(a.userId=i.get("jb_user_id"),a.userName=i.get("jb_user_name"),a.password=i.get(a.roomId)?i.get(a.roomId):"",a.userId&&a.userName)console.log("You already have a username! It is "+a.userName),d();else{var b=y[Math.floor(Math.random()*y.length)];u(b)}r.getTrendingSongs().success(function(t){"OK"===t.status?(console.log("OK backendAPI.getTrendingSongs",t),a.trending=t.data.map(function(t){return t.track})):console.log("NOT OK backendAPI.getTrendingSongs",t)}).error(function(t){console.log("ERROR backendAPI.getTrendingSongs",t)}),t.dragControlListeners={accept:function(){return!0},dragStart:function(){f=!0},dragEnd:function(){f=!1},orderChanged:function(t){var e=t.source.itemScope.element[0].dataset.uuid,o=t.dest.index;g(e,o)},containment:".song-queue"},t.deleteSong=function(t){var e=t.target.parentElement.dataset.uuid;m(e)}}])}(),function(){function t(t,e,o){function n(e,o){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(o){t.logoFill="url(#lg)",console.log("Location acquired.");var n=o.coords.latitude,i=o.coords.longitude;t.coordinates=[n,i],console.log(t.coordinates),e&&e()},function(){o&&o()},{timeout:1e3*i},{maximumAge:1e3*s}):o&&o()}var i=30,s=60;t.pageClass="home-page",t.coordinates=[],n(function(){o.searchRooms({coordinates:t.coordinates[0]+","+t.coordinates[1],distance:"10000"}).success(function(t){"OK"===t.status?(console.log("OK backendAPI.searchRooms",t),t.data.length>=1?e.path(t.data[0].id):console.log("No nearby rooms available.")):console.log("NOT OK backendAPI.searchRooms",t)}).error(function(t){console.log("NOT OK backendAPI.searchRooms",t)})},function(){console.log("Could not get location.")})}angular.module("jukebox").controller("HomeController",t),t.$inject=["$scope","$location","backendAPI","$http"]}(),function(){function t(t,e,o){function n(t){return 0===Object.keys(t).length}function i(e,n,i){o.getTracksAudioFeatures(e).then(function(e){t.featureRequestsToMake-=1;for(var o=0;o<e.audio_features.length;o++)n+1==i.length?(i[i.length-i.length%100+o]!=e.audio_features[o].id&&console.log("There is a problem at ",n,o),t.musicData[i[i.length-i.length%100+o]].audio_features=e.audio_features[o]):(n+1)%100==0?(i[n+1-100+o]!=e.audio_features[o].id&&console.log("There is a problem at ",n,o),t.musicData[i[n+1-100+o]].audio_features=e.audio_features[o]):console.log("This should never happen...")}).catch(function(t){console.log("Something went wrong!"),console.log(t)})}function s(e){t.featureRequestsToMake=Math.ceil(e.length/100),console.log(t.featureRequestsToMake);for(var o="",n=0;n<e.length;n++)o+=e[n]+",",((n+1)%100==0||n+1==e.length)&&(o=o.slice(0,-1),i(o,n,e),o="")}function r(e,n){o.getSavedUserTracks({offset:e,limit:n}).then(function(o){return console.log(e,o.items),t.savedTrackList=t.savedTrackList.concat(o.items),o.items.length<n?(console.log("Saved tracks finished loading!",t.savedTrackList),a(),!0):(setTimeout(function(){r(e+n,n)},100),void 0)}).catch(function(t){console.log("Something went wrong!"),console.log(t)})}function a(){o.getUserTopTracks({limit:50,time_range:"long_term"}).then(function(e){for(var o=0;o<e.items.length;o++)t.topTracks.long_term[e.items[o].id]=e.items[o];return!0}),o.getUserTopTracks({limit:50,time_range:"medium_term"}).then(function(e){for(var o=0;o<e.items.length;o++)t.topTracks.medium_term[e.items[o].id]=e.items[o];return!0}),o.getUserTopTracks({limit:50,time_range:"short_term"}).then(function(e){for(var o=0;o<e.items.length;o++)t.topTracks.short_term[e.items[o].id]=e.items[o];return!0})}t.pageClass="dataviz-page",t.musicLoadingIsComplete=!1,t.getSongsClicked=!1,t.musicData={},t.musicTracks=[],t.savedTrackList=[],t.topTracks={long_term:{},medium_term:{},short_term:{}},o.login(),t.login=function(){o.login()},t.getSongs=function(){t.getSongsClicked=!0,r(0,50)},t.playSelectedSong=function(e,o){t.$broadcast("updateVideoEvent",e,o)},t.$watch("featureRequestsToMake",function(){0==t.featureRequestsToMake&&(console.log("Music loading is complete!",t.musicData),t.musicTracks=Object.keys(t.musicData).map(function(e){return t.musicData[e]}),t.musicLoadingIsComplete=!0)}),t.$watch("topTracks",function(){if(!n(t.topTracks.long_term)&&!n(t.topTracks.medium_term)&&!n(t.topTracks.short_term)){console.log("All top tracks finished loading!",t.topTracks);var e=!0,o=!1,i=void 0;try{for(var r,a=t.savedTrackList[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var l=r.value,u=l.track;u.added_at=l.added_at,u.is_top=[],t.topTracks.long_term[u.id]&&u.is_top.push("long_term"),t.topTracks.medium_term[u.id]&&u.is_top.push("medium_term"),t.topTracks.short_term[u.id]&&u.is_top.push("short_term"),t.musicData[u.id]=u}}catch(c){o=!0,i=c}finally{try{!e&&a.return&&a.return()}finally{if(o)throw i}}s(Object.keys(t.musicData))}},!0)}angular.module("jukebox").controller("DatavizController",t),t.$inject=["$scope","$http","Spotify"]}(),function(t,e){e.module("spotify",[]).provider("Spotify",function(){var o={};o.clientId=null,o.redirectUri=null,o.scope=null,o.authToken=null,this.setClientId=function(t){return o.clientId=t,o.clientId},this.getClientId=function(){return o.clientId},this.setAuthToken=function(t){return o.authToken=t,o.authToken},this.setRedirectUri=function(t){return o.redirectUri=t,o.redirectUri},this.getRedirectUri=function(){return o.redirectUri},this.setScope=function(t){return o.scope=t,o.scope};var n={};n.toQueryString=function(t){var o=[];return e.forEach(t,function(t,e){this.push(encodeURIComponent(e)+"="+encodeURIComponent(t))},o),o.join("&")},o.apiBase="https://api.spotify.com/v1",this.$get=["$q","$http","$window",function(i,s,r){function a(){this.clientId=o.clientId,this.redirectUri=o.redirectUri,this.apiBase=o.apiBase,this.scope=o.scope,this.authToken=o.authToken,this.toQueryString=n.toQueryString}function l(e,o,n,i){var s=t.open(e,o,n),r=t.setInterval(function(){try{(!s||s.closed)&&(t.clearInterval(r),i(s))}catch(e){}},1e3);return s}return a.prototype={api:function(t,e,o,n,r){var a=i.defer();return s({url:this.apiBase+t,method:e?e:"GET",params:o,data:n,headers:r,withCredentials:!1}).success(function(t){a.resolve(t)}).error(function(t){a.reject(t)}),a.promise},_auth:function(t){var e={Authorization:"Bearer "+this.authToken};return t&&(e["Content-Type"]="application/json"),e},getAlbum:function(t){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/albums/"+t)},getAlbums:function(t){return t=e.isString(t)?t.split(","):t,e.forEach(t,function(e,o){t[o]=e.indexOf("spotify:")>-1?e.split(":")[2]:e}),this.api("/albums","GET",{ids:t?t.toString():""})},getAlbumTracks:function(t,e){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/albums/"+t+"/tracks","GET",e)},getArtist:function(t){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/artists/"+t)},getArtists:function(t){return t=e.isString(t)?t.split(","):t,e.forEach(t,function(e,o){t[o]=e.indexOf("spotify:")>-1?e.split(":")[2]:e}),this.api("/artists/","GET",{ids:t?t.toString():""})},getArtistAlbums:function(t,e){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/artists/"+t+"/albums","GET",e)},getArtistTopTracks:function(t,e){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/artists/"+t+"/top-tracks","GET",{country:e})},getRelatedArtists:function(t){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/artists/"+t+"/related-artists")},getFeaturedPlaylists:function(t){return this.api("/browse/featured-playlists","GET",t,null,this._auth())},getNewReleases:function(t){return this.api("/browse/new-releases","GET",t,null,this._auth())},getCategories:function(t){return this.api("/browse/categories","GET",t,null,this._auth())},getCategory:function(t,e){return this.api("/browse/categories/"+t,"GET",e,null,this._auth())},getCategoryPlaylists:function(t,e){return this.api("/browse/categories/"+t+"/playlists","GET",e,null,this._auth())},getRecommendations:function(t){return this.api("/recommendations","GET",t,null,this._auth())},getAvailableGenreSeeds:function(){return this.api("/recommendations/available-genre-seeds","GET",null,null,this._auth())},following:function(t,e){return e=e||{},e.type=t,this.api("/me/following","GET",e,null,this._auth())},follow:function(t,e){return this.api("/me/following","PUT",{type:t,ids:e},null,this._auth())},unfollow:function(t,e){return this.api("/me/following","DELETE",{type:t,ids:e},null,this._auth())},userFollowingContains:function(t,e){return this.api("/me/following/contains","GET",{type:t,ids:e},null,this._auth())},followPlaylist:function(t,e,o){return this.api("/users/"+t+"/playlists/"+e+"/followers","PUT",null,{"public":o||null},this._auth(!0))},unfollowPlaylist:function(t,e){return this.api("/users/"+t+"/playlists/"+e+"/followers","DELETE",null,null,this._auth())},playlistFollowingContains:function(t,e,o){return this.api("/users/"+t+"/playlists/"+e+"/followers/contains","GET",{ids:o.toString()},null,this._auth())},getSavedUserTracks:function(t){return this.api("/me/tracks","GET",t,null,this._auth())},userTracksContains:function(t){return t=e.isString(t)?t.split(","):t,e.forEach(t,function(e,o){t[o]=e.indexOf("spotify:")>-1?e.split(":")[2]:e}),this.api("/me/tracks/contains","GET",{ids:t.toString()},null,this._auth())},saveUserTracks:function(t){return t=e.isString(t)?t.split(","):t,e.forEach(t,function(e,o){t[o]=e.indexOf("spotify:")>-1?e.split(":")[2]:e}),this.api("/me/tracks","PUT",{ids:t.toString()},null,this._auth())},removeUserTracks:function(t){return t=e.isString(t)?t.split(","):t,e.forEach(t,function(e,o){t[o]=e.indexOf("spotify:")>-1?e.split(":")[2]:e}),this.api("/me/tracks","DELETE",{ids:t.toString()},null,this._auth(!0))},saveUserAlbums:function(t){return t=e.isString(t)?t.split(","):t,e.forEach(t,function(e,o){t[o]=e.indexOf("spotify:")>-1?e.split(":")[2]:e}),this.api("/me/albums","PUT",{ids:t.toString()},null,this._auth())},getSavedUserAlbums:function(t){return this.api("/me/albums","GET",t,null,this._auth())},removeUserAlbums:function(t){return t=e.isString(t)?t.split(","):t,e.forEach(t,function(e,o){t[o]=e.indexOf("spotify:")>-1?e.split(":")[2]:e}),this.api("/me/albums","DELETE",{ids:t.toString()},null,this._auth(!0))},userAlbumsContains:function(t){return t=e.isString(t)?t.split(","):t,e.forEach(t,function(e,o){t[o]=e.indexOf("spotify:")>-1?e.split(":")[2]:e}),this.api("/me/albums/contains","GET",{ids:t.toString()},null,this._auth())},getUserTopArtists:function(t){return t=t||{},this.api("/me/top/artists","GET",t,null,this._auth())},getUserTopTracks:function(t){return t=t||{},this.api("/me/top/tracks","GET",t,null,this._auth())},getUserPlaylists:function(t,e){return this.api("/users/"+t+"/playlists","GET",e,null,{Authorization:"Bearer "+this.authToken})},getPlaylist:function(t,e,o){return this.api("/users/"+t+"/playlists/"+e,"GET",o,null,this._auth())},getPlaylistTracks:function(t,e,o){return this.api("/users/"+t+"/playlists/"+e+"/tracks","GET",o,null,this._auth())},createPlaylist:function(t,e){return this.api("/users/"+t+"/playlists","POST",null,e,this._auth(!0))},addPlaylistTracks:function(t,o,n,i){return n=e.isArray(n)?n:n.split(","),e.forEach(n,function(t,e){n[e]=-1===t.indexOf("spotify:")?"spotify:track:"+t:t}),this.api("/users/"+t+"/playlists/"+o+"/tracks","POST",{uris:n.toString(),position:i?i.position:null},null,this._auth(!0))},removePlaylistTracks:function(t,o,n){n=e.isArray(n)?n:n.split(",");var i;return e.forEach(n,function(t,e){i=n[e],n[e]={uri:-1===i.indexOf("spotify:")?"spotify:track:"+i:i}}),this.api("/users/"+t+"/playlists/"+o+"/tracks","DELETE",null,{tracks:n},this._auth(!0))},reorderPlaylistTracks:function(t,e,o){return this.api("/users/"+t+"/playlists/"+e+"/tracks","PUT",null,o,this._auth(!0))},replacePlaylistTracks:function(t,o,n){n=e.isArray(n)?n:n.split(",");var i;return e.forEach(n,function(t,e){i=n[e],n[e]=-1===i.indexOf("spotify:")?"spotify:track:"+i:i}),this.api("/users/"+t+"/playlists/"+o+"/tracks","PUT",{uris:n.toString()},null,this._auth(!0))},updatePlaylistDetails:function(t,e,o){return this.api("/users/"+t+"/playlists/"+e,"PUT",null,o,this._auth(!0))},getUser:function(t){return this.api("/users/"+t)},getCurrentUser:function(){return this.api("/me","GET",null,null,this._auth())},search:function(t,e,o){return o=o||{},o.q=t,o.type=e,this.api("/search","GET",o)},getTrack:function(t){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/tracks/"+t)},getTracks:function(t){return t=e.isString(t)?t.split(","):t,e.forEach(t,function(e,o){t[o]=e.indexOf("spotify:")>-1?e.split(":")[2]:e}),this.api("/tracks/","GET",{ids:t?t.toString():""})},getTrackAudioFeatures:function(t){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/audio-features/"+t,"GET",null,null,this._auth())},getTracksAudioFeatures:function(t){return t=e.isString(t)?t.split(","):t,e.forEach(t,function(e,o){t[o]=e.indexOf("spotify:")>-1?e.split(":")[2]:e}),this.api("/audio-features/","GET",{ids:t?t.toString():""},null,this._auth())},setAuthToken:function(t){return this.authToken=t,this.authToken},login:function(){function t(n){"spotify-token"===n.key&&(p&&p.close(),d=!0,o.setAuthToken(n.newValue),r.removeEventListener("storage",t,!1),e.resolve(n.newValue))}var e=i.defer(),o=this,n=400,s=500,a=screen.width/2-n/2,u=screen.height/2-s/2,c={client_id:this.clientId,redirect_uri:this.redirectUri,scope:this.scope||"",response_type:"token"},d=!1,p=l("https://accounts.spotify.com/authorize?"+this.toQueryString(c),"Spotify","menubar=no,location=no,resizable=yes,scrollbars=yes,status=no,width="+n+",height="+s+",top="+u+",left="+a,function(){d||e.reject()});return r.addEventListener("storage",t,!1),e.promise}},new a}]})}(window,angular),function(t){try{t=angular.module("jukebox")}catch(e){t=angular.module("jukebox",[])}t.run(["$templateCache",function(t){t.put("/jukebox/dataviz/dataviz.html",'<div class="dataviz-page"><div class="header"><div>Jukebox</div><button ng-click="login()">Login</button> <button ng-click="getSongs()">Get Songs</button></div><div ng-if="!getSongsClicked" class="explainer-text">Click Get Songs to get started. &mapstoup;</div><div ng-if="getSongsClicked && !musicLoadingIsComplete" spinner></div><div ng-controller="GraphController" ng-if="musicLoadingIsComplete"><div class="graph-view"><div id="mygraph" ng-class="selectedTimePeriod"><div class="mydiv"></div></div></div><div ng-controller="GraphControlsController"><div class="graph-controls-view"><div class="control-box"><div class="content">Top tracks from<select ng-model="selectedTimePeriod" ng-change="changeTopTimePeriod()" name="time-period"><option value="long_term">All time</option><option value="medium_term">Last 6 months</option><option value="short_term">Last 4 weeks</option></select><br>Hide non top tracks? <input type="checkbox" ng-change="toggleHiddenNonTopTracks()" name="hide-non-top" ng-model="nonTopTracksHidden"><br>Display tracks based on<br><select ng-model="yAxisCategory" ng-change="changeYAxisCategory()" name="y-axis-category"><option value="danceability">Danceability</option><option value="energy">Energy</option><option value="speechiness">Speechiness</option><option value="acousticness">Acousticness</option><option value="instrumentalness">Instrumentalness</option><option value="liveness">Liveness</option><option value="valence">Valence</option></select>x<select ng-model="xAxisCategory" ng-change="changeXAxisCategory()" name="x-axis-category"><option value="time">Date added</option></select></div></div></div></div></div><div ng-controller="YoutubeController"><div class="iframe-container"><iframe id="ytplayer" type="text/html" ng-src="{{ yt_video_id | youtubeEmbedUrl }}" frameborder="0" allowfullscreen></div></div></div>')}])}(),function(t){try{t=angular.module("jukebox")}catch(e){t=angular.module("jukebox",[])}t.run(["$templateCache",function(t){t.put("/jukebox/dataviz/spotify_login.html",'<script>var hash = window.location.hash;\n  if (window.location.search.substring(1).indexOf("error") !== -1) {\n    // login failure\n    console.log("Spotify login failure.");\n    window.close();\n  } else if (hash) {\n    var token = window.location.hash.split(\'&\')[0].split(\'=\')[1];\n    if (token) {\n      // login success\n      console.log("Spotify login success.");\n      localStorage.setItem(\'spotify-token\', token);\n    } else {\n      console.log("Spotify token is undefined.");\n    }\n  }</script>')}])}(),function(t){try{t=angular.module("jukebox")}catch(e){t=angular.module("jukebox",[])}t.run(["$templateCache",function(t){t.put("/jukebox/home/home.html",'<div class="home-page"><div class="jb-icon"><svg><lineargradient id="lg" x1="1" y1="1" x2="0" y2="0"><stop offset="0%" stop-opacity="1" stop-color="white"><stop offset="0%" stop-opacity="1" stop-color="white"><animate attributename="offset" values="0;1" fill="freeze" repeatcount="0" dur="5s" begin="0s"></stop><stop offset="0%" stop-opacity="1" stop-color="black"><animate attributename="offset" values="0;1" fill="freeze" repeatcount="0" dur="5s" begin="0s"></stop><stop offset="100%" stop-opacity="1" stop-color="black"></lineargradient><use xlink:href="#plus-icon"></use></svg></div></div>')}])}(),function(t){try{t=angular.module("jukebox")}catch(e){t=angular.module("jukebox",[])}t.run(["$templateCache",function(t){t.put("/jukebox/queue/queue.html",'<div class="desktop-content"><div ng-controller="YoutubeController" ng-if="room.queue[0] && !mobile"><div class="iframe-container"><iframe id="ytplayer" type="text/html" ng-src="{{ yt_video_id | youtubeEmbedUrl }}" frameborder="0" allowfullscreen></div></div></div><div class="queue-wrapper"><div ng-if="!room.loaded" spinner></div><div ng-if="room.loaded"><div header currently-playing="room.queue[0]"></div><div class="song-queue" data-as-sortable="dragControlListeners" data-ng-model="room.queue"><div ng-repeat="song in room.queue"><div class="song-queue-item noselect" data-uuid="{{ song.unique_id }}" data-as-sortable-item ng-swipe-left="showDeleteButton = true" ng-swipe-right="showDeleteButton = false"><img src="{{ song.image_url }}" class="song-image"><div class="song-info"><div class="song-title">{{ song.track }}</div><div class="song-artist">{{ song.artist }}</div><div class="song-user">@{{ song.submitter }}</div></div><i class="fa fa-th-list drag-button" ng-if="room.allAdmin && !showDeleteButton" data-as-sortable-item-handle></i> <i class="fa fa-trash fa-lg delete-button" ng-if="room.allAdmin && showDeleteButton" ng-click="deleteSong($event)"></i></div></div></div></div></div><div plus-button></div>')}])}(),function(t){try{t=angular.module("jukebox")}catch(e){t=angular.module("jukebox",[])}t.run(["$templateCache",function(t){t.put("/jukebox/search/search.html",'<div class="search-wrapper"><div class="search-header-items"><div class="search-header-item search"><input id="song-search-box" type="search" ng-model="searchText" ng-model-options="{ debounce: 500 }" ng-change="myData.sendQuery()" placeholder="Search Spotify..." autofocus></div><div class="search-header-item close-search"><button ng-click="closeSearch()"><span>Cancel</span></button></div></div><div class="song-suggestions" ng-if="!myData.spotify.results && !searchText"><div class="song-results-header"><span>Trending</span></div><div ng-if="myData.spotify.suggestions.length > 0"><div ng-repeat="result in myData.spotify.suggestions"><div ng-click="addSong(result.uri, result.name, result.artists[0].name, result.album.name, result.album.images[0].url)" class="song-search-result"><img src="{{ result.album.images[0].url }}" class="song-image"><div class="song-info"><div class="song-title">{{ result.name }}</div><div class="song-artist">{{ result.artists[0].name }}</div></div></div></div></div></div><div class="song-search-results"><div ng-if="myData.spotify.results.length > 0"><div ng-repeat="result in myData.spotify.results"><div ng-click="addSong(result.uri, result.name, result.artists[0].name, result.album.name, result.album.images[0].url)" class="song-search-result"><img src="{{ result.album.images[0].url }}" class="song-image"><div class="song-info"><div class="song-title">{{ result.name }}</div><div class="song-artist">{{ result.artists[0].name }}</div></div></div></div></div></div><div ng-if="querying"><div spinner></div></div></div>')
}])}(),function(t){try{t=angular.module("jukebox")}catch(e){t=angular.module("jukebox",[])}t.run(["$templateCache",function(t){t.put("/jukebox/common/footer/footer.html",'<div class="footer"><div class="footer-label"><span>Jukebox App</span></div><div class="footer-copyright"><span>&copy; 2016, All rights reserved.</span></div></div>')}])}(),function(t){try{t=angular.module("jukebox")}catch(e){t=angular.module("jukebox",[])}t.run(["$templateCache",function(t){t.put("/jukebox/common/header/header.html",'<div class="header"><div class="header-info" ng-if="currentlyPlaying"><div class="header-label song"><span>{{ currentlyPlaying.track }}</span></div><div class="header-label artist"><span>{{ currentlyPlaying.artist }}</span></div><div class="header-label user"><span>@{{ currentlyPlaying.submitter }}</span></div></div><div class="record-player"><div class="record" ng-if="currentlyPlaying"><img src="{{ currentlyPlaying.image_url }}"></div><div class="record" ng-if="!currentlyPlaying"><svg><use xlink:href="#plus-icon"></use></svg></div></div></div>')}])}(),function(t){try{t=angular.module("jukebox")}catch(e){t=angular.module("jukebox",[])}t.run(["$templateCache",function(t){t.put("/jukebox/common/plusButton/plusButton.html",'<button ng-click="showSearch()" class="plus-button"><div class="plus-icon"><svg><use xlink:href="#plus-icon"></use></svg></div></button>')}])}(),function(t){try{t=angular.module("jukebox")}catch(e){t=angular.module("jukebox",[])}t.run(["$templateCache",function(t){t.put("/jukebox/common/ui-elements/defaultModal.html",'<div class="default" tabindex="-1"><div class="modal-header"><h3 class="modal-title">{{ modal_title }}</h3></div><form><div class="modal-body" compile ng-bind-html="modal_body_html"></div><div class="modal-footer"><button class="btn btn-primary" type="submit" ng-click="ok()">{{ primary_btn_text }}</button><div ng-if="secondary_btn_text"><button class="btn btn-warning" type="button" ng-click="cancel()">{{ secondary_btn_text }}</button></div></div></form></div>')}])}();