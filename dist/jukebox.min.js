!function(){"use strict";function e(e){e.when("/:roomId",{controller:"QueueController",templateUrl:"queue/queue.html"}).when("/",{controller:"HomeController",templateUrl:"home/home.html"}).otherwise({redirectTo:"/"})}angular.module("jukebox",["ngRoute","ngAnimate","ui.bootstrap","as.sortable","ngTouch","ngCookies","matchMedia"]).directive("compile",["$compile","$timeout",function(e,o){return{restrict:"A",link:function(t,n){o(function(){e(n.contents())(t)})}}}]).config(e),e.$inject=["$routeProvider"]}(),function(){"use strict";function e(e,o,t,n,r){function s(){("mobile"!=o.responsiveVersion||""!==e.yt_video_id)&&e.room.queue[0].unique_id!=l&&(l=r.queue[0].unique_id,a().success(function(o){console.log("OK YoutubeController.updateCurrentVideo",o),o.items.length>=1&&(e.yt_video_id=o.items[0].id.videoId)}).error(function(e){console.log("ERROR YoutubeController.updateCurrentVideo",e)}))}function a(){return t({url:"https://www.googleapis.com/youtube/v3/search",method:"GET",params:{part:"snippet",key:u,q:e.room.queue[0].track+" "+e.room.queue[0].artist,type:"video",videoEmbeddable:"true"}})}var u="AIzaSyALGbklexv5u7P3zjV4xJCYfEYLwwukfkE";e.room=r,e.yt_video_id="";var l="";o.$watch("responsiveVersion",function(){s()}),e.$watch("room.queue",function(){s()})}angular.module("jukebox").controller("YoutubeController",e).filter("youtubeEmbedUrl",["$sce",function(e){return function(o){return e.trustAsResourceUrl("http://www.youtube.com/embed/"+o+"?autoplay=1&iv_load_policy=3&origin=http://letsjukebox.com/")}}]),e.$inject=["$scope","$rootScope","$http","$sce","sharedRoomData"]}(),function(){"use strict";angular.module("jukebox").factory("sharedRoomData",function(){var e={roomId:"",roomName:"",passwordProtected:!1,roomPassword:"",userId:"",userName:"",queue:{}};return e})}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,templateUrl:"common/plusButton/plusButton.html",controller:["$scope","$uibModal",function(e,o){e.showSearch=function(){o.open({templateUrl:"search/search.html",controller:"SearchController",windowClass:"search-page",keyboard:!1})}}]}}angular.module("jukebox").directive("plusButton",e)}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,scope:{currentlyPlaying:"="},templateUrl:"common/header/header.html"}}angular.module("jukebox").directive("header",e).filter("spotifyEmbedUrl",["$sce",function(e){return function(o){return e.trustAsResourceUrl("https://embed.spotify.com/?uri="+o)}}])}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,scope:{},templateUrl:"common/footer/footer.html"}}angular.module("jukebox").directive("footer",e)}(),function(){"use strict";angular.module("jukebox").factory("backendAPI",["$http",function(e){var o="/api",t={};e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var n=function(e){var o,t,r,s,a,u,l,i="";for(o in e)if(t=e[o],t instanceof Array)for(l=0;l<t.length;++l)a=t[l],r=o+"["+l+"]",u={},u[r]=a,i+=n(u)+"&";else if(t instanceof Object)for(s in t)a=t[s],r=o+"["+s+"]",u={},u[r]=a,i+=n(u)+"&";else void 0!==t&&null!==t&&(i+=encodeURIComponent(o)+"="+encodeURIComponent(t)+"&");return i.length?i.substr(0,i.length-1):i};return e.defaults.transformRequest=[function(e){return angular.isObject(e)&&"[object File]"!==String(e)?n(e):e}],t.registerUser=function(t){return e.post(o+"/register_user",t)},t.changeUsername=function(t){return e.post(o+"/change_username",t)},t.joinRoom=function(t){return e.post(o+"/join_room",t)},t.getSongQueue=function(t){return e({method:"GET",url:o+"/get_song_queue",params:t})},t.addSong=function(t){return e.post(o+"/submit_song",t)},t.reorderSong=function(t){return e.post(o+"/reorder_song",t)},t.deleteSong=function(t){return e.post(o+"/delete_song",t)},t.searchRooms=function(t){return e.post(o+"/search_room",t)},t}])}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,scope:{},templateUrl:"search/search.html",controller:["$scope",function(){}]}}angular.module("jukebox").directive("search",e)}(),function(){"use strict";function e(e,o,t,n,r,s){function a(){n.getSongQueue({room_id:r.roomId,password:r.password}).success(function(e){"OK"===e.status?(r.roomName=e.room_name,r.queue=e.data,console.log("OK backendAPI.getSongQueue",e)):console.log("NOT OK backendAPI.getSongQueue",e)}).error(function(e){console.log("ERROR backendAPI.getSongQueue",e)})}e.roomId=o.roomId,e.myData={},e.myData.spotify={},e.myData.sendQuery=function(){var o=t.get("https://api.spotify.com/v1/search",{params:{q:e.searchText,type:"track"}});o.success(function(o){console.log("OK SearchController.sendQuery",o),e.myData.spotify.results=o.tracks.items}),o.error(function(o){e.myData.spotify={},console.log("ERROR SearchController.sendQuery",o)})},e.closeSearch=function(){s.close()},e.addSong=function(o,t,s,u,l){n.addSong({room_id:r.roomId,user_id:r.userId,password:r.password,url:o,track:t,artist:s,album:u,album_art_url:l}).success(function(o){"OK"===o.status?(a(),console.log("OK backendAPI.addSong",o)):console.log("NOT OK backendAPI.addSong",o),e.closeSearch()}).error(function(e){console.log("ERROR backendAPI.addSong",e)})}}angular.module("jukebox").controller("SearchController",e),e.$inject=["$scope","$routeParams","$http","backendAPI","sharedRoomData","$uibModalInstance"]}(),function(){"use strict";angular.module("jukebox").controller("QueueController",["$scope","$rootScope","$interval","$routeParams","$cookies","$uibModal","backendAPI","sharedRoomData","screenSize",function(e,o,t,n,r,s,a,u,l){function i(e){s.open({templateUrl:"common/ui-elements/defaultModal.html",controller:["$scope","$sce","$uibModalInstance","sharedRoomData",function(o,t,n,r){o.aliasInput=e,o.modal_title="Enter Your Alias",o.modal_body_html=t.trustAsHtml('<span>@</span><input type="text" ng-model="aliasInput" class="form-control" placeholder="'+e+'" required />'),o.primary_btn_text="CONTINUE",o.ok=function(){console.log(o.aliasInput),/[^a-zA-Z0-9]/.test(o.aliasInput)||(n.close(),r.userName=o.aliasInput,c(r.userName))}}],backdrop:"static",windowClass:"default"})}function c(e){a.registerUser({username:e}).success(function(e){"OK"===e.status?(u.userId=e.data,r.put("jb_user_name",u.userName),r.put("jb_user_id",u.userId),d(),console.log("OK backendAPI.registerUser",e)):console.log("NOT OK backendAPI.registerUser",e)}).error(function(e){console.log("ERROR backendAPI.registerUser",e)})}function d(){a.joinRoom({room_id:u.roomId,user_id:u.userId,password:u.password}).success(function(e){"OK"===e.status?(console.log("OK backendAPI.joinRoom",e),m()):("The correct password was not provided."==e.message&&(u.passwordProtected=!0,u.password=window.prompt("Enter the password:"),r.put(u.roomId,u.password),d()),console.log("NOT OK backendAPI.joinRoom",e))}).error(function(e){console.log("ERROR backendAPI.joinRoom",e)})}function m(){a.getSongQueue({room_id:u.roomId,password:u.password}).success(function(e){"OK"===e.status?(u.roomName=e.room_name,u.queue=e.data,f||(f=t(function(){m()},h)),console.log("OK backendAPI.getSongQueue",e)):("The correct password was not provided."==e.message&&(u.passwordProtected=!0,u.password=window.prompt("Enter the password:"),r.put(u.roomId,u.password),m()),console.log("NOT OK backendAPI.getSongQueue",e))}).error(function(e){console.log("ERROR backendAPI.getSongQueue",e)})}function g(e,o){a.reorderSong({room_id:u.roomId,user_id:u.userId,password:u.password,song_id:e,new_pos:o}).success(function(e){"OK"===e.status?(console.log("OK backendAPI.reorderSong",e),m()):console.log("NOT OK backendAPI.reorderSong",e)}).error(function(){console.log("ERROR backendAPI.reorderSong",error)})}function p(e){a.deleteSong({room_id:u.roomId,user_id:u.userId,password:u.password,song_id:e}).success(function(e){"OK"===e.status?(console.log("OK backendAPI.deleteSong",e),m()):console.log("NOT OK backendAPI.deleteSong",e)}).error(function(){console.log("ERROR backendAPI.deleteSong",error)})}e.pageClass="queue-page";var f=void 0,h=3e3;o.responsiveVersion=l.is("xs, sm")?"mobile":"desktop",e.mobile=l.on("xs, sm",function(t){e.mobile=t,o.responsiveVersion=t?"mobile":"desktop"}),e.room=u,u.roomId=n.roomId,e.roomId=u.roomId;var b=["BlueTrout","YellowDuck","RedHerring","BoredMoose","SillyWhale","OrangeEagle","VelvetMouse","GreenMonkey","VioletLobster","ConfusedTucan","WileySloth"];if(u.userId=r.get("jb_user_id"),u.userName=r.get("jb_user_name"),u.password=r.get(u.roomId)?r.get(u.roomId):"",u.userId&&u.userName)console.log("You already have a username! It is "+u.userName),d();else{var v=b[Math.floor(Math.random()*b.length)];i(v),c(u.userName)}e.dragControlListeners={accept:function(){return!0},itemMoved:function(){},orderChanged:function(e){var o=e.source.itemScope.element[0].dataset.uuid,t=e.dest.index;g(o,t)}},e.deleteSong=function(e){var o=e.target.parentElement.dataset.uuid;p(o)}}])}(),function(){"use strict";function e(e,o,t){function n(o,t){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){e.logoFill="url(#lg)",console.log("Location acquired.");var n=t.coords.latitude,r=t.coords.longitude;e.coordinates=[n,r],console.log(e.coordinates),o&&o()},function(){t&&t()},{timeout:1e3*r},{maximumAge:1e3*s}):t&&t()}var r=30,s=60;e.pageClass="home-page",e.coordinates=[],n(function(){t.searchRooms({coordinates:e.coordinates[0]+","+e.coordinates[1],distance:"10000"}).success(function(e){"OK"===e.status?(console.log("OK backendAPI.searchRooms",e),e.data.length>=1?o.path(e.data[0].id):console.log("No nearby rooms available.")):console.log("NOT OK backendAPI.searchRooms",e)}).error(function(e){console.log("NOT OK backendAPI.searchRooms",e)})},function(){console.log("Could not get location.")})}angular.module("jukebox").controller("HomeController",e),e.$inject=["$scope","$location","backendAPI"]}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/home/home.html",'<div class="home-page"><div class="jb-icon"><svg><lineargradient id="lg" x1="1" y1="1" x2="0" y2="0"><stop offset="0%" stop-opacity="1" stop-color="white"><stop offset="0%" stop-opacity="1" stop-color="white"><animate attributename="offset" values="0;1" fill="freeze" repeatcount="0" dur="5s" begin="0s"></stop><stop offset="0%" stop-opacity="1" stop-color="black"><animate attributename="offset" values="0;1" fill="freeze" repeatcount="0" dur="5s" begin="0s"></stop><stop offset="100%" stop-opacity="1" stop-color="black"></lineargradient><use xlink:href="#plus-icon"></use></svg></div></div>')}])}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/queue/queue.html",'<div class="desktop-content"><div ng-controller="YoutubeController" ng-if="room.queue[0]"><div class="iframe-container"><iframe id="ytplayer" type="text/html" ng-src="{{ yt_video_id | youtubeEmbedUrl }}" frameborder="0" allowfullscreen></div></div></div><div class="queue-wrapper"><div header currently-playing="room.queue[0]"></div><div ng-if="queueData.length > 0"><span>Your Song Queue</span></div><div class="song-queue" data-as-sortable="dragControlListeners" data-ng-model="room.queue"><div ng-repeat="song in room.queue"><div class="song-queue-item noselect" data-uuid="{{ song.unique_id }}" data-as-sortable-item ng-swipe-left="showDeleteButton = true" ng-swipe-right="showDeleteButton = false"><img src="{{ song.image_url }}" class="song-image"><div class="song-info"><div class="song-title">{{ song.track }}</div><div class="song-artist">{{ song.artist }}</div><div class="song-user">@{{ song.submitter }}</div></div><i class="fa fa-th-list drag-button" ng-if="!showDeleteButton" data-as-sortable-item-handle></i> <i class="fa fa-trash fa-lg delete-button" ng-if="showDeleteButton" ng-click="deleteSong($event)"></i></div></div></div></div><div plus-button></div>')}])}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/search/search.html",'<div class="search-wrapper"><div class="search-header-items"><div class="search-header-item close-search"><button ng-click="closeSearch()"><span>Cancel</span></button></div><div class="search-header-item search"><input id="song-search-box" type="search" ng-model="searchText" ng-model-options="{ debounce: 500 }" ng-change="myData.sendQuery()" placeholder="Search Spotify..." autofocus></div></div><div class="song-search-results"><div ng-repeat="result in myData.spotify.results"><div ng-click="addSong(result.uri, result.name, result.artists[0].name, result.album.name, result.album.images[0].url)" class="song-search-result"><img src="{{ result.album.images[0].url }}" class="song-image"><div class="song-info"><div class="song-title">{{ result.name }}</div><div class="song-artist">{{ result.artists[0].name }}</div></div></div></div></div></div>')}])}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/common/footer/footer.html",'<div class="footer"><div class="footer-label"><span>Jukebox App</span></div><div class="footer-copyright"><span>&copy; 2016, All rights reserved.</span></div></div>')}])}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/common/plusButton/plusButton.html",'<button ng-click="showSearch()" class="plus-button"><div class="plus-icon"><svg><use xlink:href="#plus-icon"></use></svg></div></button>')}])}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/common/header/header.html",'<div class="header"><div class="header-info" ng-if="currentlyPlaying"><div class="header-label song"><span>{{ currentlyPlaying.track }}</span></div><div class="header-label artist"><span>{{ currentlyPlaying.artist }}</span></div><div class="header-label user"><span>@{{ currentlyPlaying.submitter }}</span></div></div><div class="record-player"><div class="record" ng-if="currentlyPlaying"><img src="{{ currentlyPlaying.image_url }}"></div></div></div>')}])}(),function(e){try{e=angular.module("jukebox")}catch(o){e=angular.module("jukebox",[])}e.run(["$templateCache",function(e){e.put("/jukebox/common/ui-elements/defaultModal.html",'<div class="default"><div class="modal-header"><h3 class="modal-title">{{ modal_title }}</h3></div><div class="modal-body" compile ng-bind-html="modal_body_html"></div><div class="modal-footer"><button class="btn btn-primary" type="button" ng-click="ok()">{{ primary_btn_text }}</button><div ng-if="secondary_btn_text"><button class="btn btn-warning" type="button" ng-click="cancel()">{{ secondary_btn_text }}</button></div></div></div>')}])}();